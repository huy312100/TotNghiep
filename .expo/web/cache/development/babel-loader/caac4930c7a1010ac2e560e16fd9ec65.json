{"ast":null,"code":"import _classCallCheck from \"@babel/runtime/helpers/classCallCheck\";\nimport _createClass from \"@babel/runtime/helpers/createClass\";\nimport _inherits from \"@babel/runtime/helpers/inherits\";\nimport _possibleConstructorReturn from \"@babel/runtime/helpers/possibleConstructorReturn\";\nimport _getPrototypeOf from \"@babel/runtime/helpers/getPrototypeOf\";\nvar _jsxFileName = \"E:\\\\TotNghiep\\\\TotNghiep\\\\src\\\\screens\\\\home\\\\calendar\\\\timeline_calendar\\\\DayView.js\";\n\nfunction _createSuper(Derived) { var hasNativeReflectConstruct = _isNativeReflectConstruct(); return function _createSuperInternal() { var Super = _getPrototypeOf(Derived), result; if (hasNativeReflectConstruct) { var NewTarget = _getPrototypeOf(this).constructor; result = Reflect.construct(Super, arguments, NewTarget); } else { result = Super.apply(this, arguments); } return _possibleConstructorReturn(this, result); }; }\n\nfunction _isNativeReflectConstruct() { if (typeof Reflect === \"undefined\" || !Reflect.construct) return false; if (Reflect.construct.sham) return false; if (typeof Proxy === \"function\") return true; try { Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {})); return true; } catch (e) { return false; } }\n\nimport View from \"react-native-web/dist/exports/View\";\nimport Text from \"react-native-web/dist/exports/Text\";\nimport ScrollView from \"react-native-web/dist/exports/ScrollView\";\nimport TouchableOpacity from \"react-native-web/dist/exports/TouchableOpacity\";\nimport populateEvents from \"./Packer\";\nimport React from 'react';\nimport moment from 'moment';\nimport _ from 'lodash';\nvar LEFT_MARGIN = 60 - 1;\nvar CALENDER_HEIGHT = 2400;\nvar TEXT_LINE_HEIGHT = 17;\n\nfunction range(from, to) {\n  return Array.from(Array(to), function (_, i) {\n    return from + i;\n  });\n}\n\nvar DayView = function (_React$PureComponent) {\n  _inherits(DayView, _React$PureComponent);\n\n  var _super = _createSuper(DayView);\n\n  function DayView(props) {\n    var _this;\n\n    _classCallCheck(this, DayView);\n\n    _this = _super.call(this, props);\n    _this.calendarHeight = (props.end - props.start) * 100;\n    var width = props.width - LEFT_MARGIN;\n    var packedEvents = populateEvents(props.events, width, props.start);\n    var initPosition = _.min(_.map(packedEvents, 'top')) - _this.calendarHeight / (props.end - props.start);\n    initPosition = initPosition < 0 ? 0 : initPosition;\n    _this.state = {\n      _scrollY: initPosition,\n      packedEvents: packedEvents\n    };\n    return _this;\n  }\n\n  _createClass(DayView, [{\n    key: \"UNSAFE_componentWillReceiveProps\",\n    value: function UNSAFE_componentWillReceiveProps(nextProps) {\n      var width = nextProps.width - LEFT_MARGIN;\n      this.setState({\n        packedEvents: populateEvents(nextProps.events, width, nextProps.start)\n      });\n    }\n  }, {\n    key: \"componentDidMount\",\n    value: function componentDidMount() {\n      this.props.scrollToFirst && this.scrollToFirst();\n    }\n  }, {\n    key: \"scrollToFirst\",\n    value: function scrollToFirst() {\n      var _this2 = this;\n\n      setTimeout(function () {\n        if (_this2.state && _this2.state._scrollY && _this2._scrollView) {\n          _this2._scrollView.scrollTo({\n            x: 0,\n            y: _this2.state._scrollY,\n            animated: true\n          });\n        }\n      }, 1);\n    }\n  }, {\n    key: \"_renderLines\",\n    value: function _renderLines() {\n      var _this3 = this;\n\n      var _this$props = this.props,\n          format24h = _this$props.format24h,\n          start = _this$props.start,\n          end = _this$props.end;\n      var offset = this.calendarHeight / (end - start);\n      return range(start, end + 1).map(function (i, index) {\n        var timeText;\n\n        if (i === start) {\n          timeText = \"\";\n        } else if (i < 12) {\n          timeText = !format24h ? i + \" AM\" : i + \":00\";\n        } else if (i === 12) {\n          timeText = !format24h ? i + \" PM\" : i + \":00\";\n        } else if (i === 24) {\n          timeText = !format24h ? \"12 AM\" : \"23:59\";\n        } else {\n          timeText = !format24h ? i - 12 + \" PM\" : i + \":00\";\n        }\n\n        var _this3$props = _this3.props,\n            width = _this3$props.width,\n            styles = _this3$props.styles;\n        return [React.createElement(Text, {\n          key: \"timeLabel\" + i,\n          style: [styles.timeLabel, {\n            top: offset * index - 6\n          }],\n          __self: _this3,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 78,\n            columnNumber: 9\n          }\n        }, timeText), i === start ? null : React.createElement(View, {\n          key: \"line\" + i,\n          style: [styles.line, {\n            top: offset * index,\n            width: width - 20\n          }],\n          __self: _this3,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 85,\n            columnNumber: 11\n          }\n        }), React.createElement(View, {\n          key: \"lineHalf\" + i,\n          style: [styles.line, {\n            top: offset * (index + 0.5),\n            width: width - 20\n          }],\n          __self: _this3,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 90,\n            columnNumber: 9\n          }\n        })];\n      });\n    }\n  }, {\n    key: \"_renderTimeLabels\",\n    value: function _renderTimeLabels() {\n      var _this4 = this;\n\n      var _this$props2 = this.props,\n          styles = _this$props2.styles,\n          start = _this$props2.start,\n          end = _this$props2.end;\n      var offset = this.calendarHeight / (end - start);\n      return range(start, end).map(function (item, i) {\n        return React.createElement(View, {\n          key: \"line\" + i,\n          style: [styles.line, {\n            top: offset * i\n          }],\n          __self: _this4,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 106,\n            columnNumber: 9\n          }\n        });\n      });\n    }\n  }, {\n    key: \"_onEventTapped\",\n    value: function _onEventTapped(event) {\n      this.props.eventTapped(event);\n    }\n  }, {\n    key: \"_renderEvents\",\n    value: function _renderEvents() {\n      var _this5 = this;\n\n      var styles = this.props.styles;\n      var packedEvents = this.state.packedEvents;\n      var events = packedEvents.map(function (event, i) {\n        var style = {\n          left: event.left,\n          height: event.height,\n          width: event.width,\n          top: event.top\n        };\n        var eventColor = {\n          backgroundColor: event.color\n        };\n        var numberOfLines = Math.floor(event.height / TEXT_LINE_HEIGHT);\n        var formatTime = _this5.props.format24h ? 'HH:mm' : 'hh:mm A';\n        return React.createElement(TouchableOpacity, {\n          activeOpacity: 0.5,\n          onPress: function onPress() {\n            return _this5._onEventTapped(_this5.props.events[event.index]);\n          },\n          key: i,\n          style: [styles.event, style, event.color && eventColor],\n          __self: _this5,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 135,\n            columnNumber: 9\n          }\n        }, _this5.props.renderEvent ? _this5.props.renderEvent(event) : React.createElement(View, {\n          __self: _this5,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 145,\n            columnNumber: 13\n          }\n        }, React.createElement(Text, {\n          numberOfLines: 1,\n          style: styles.eventTitle,\n          __self: _this5,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 146,\n            columnNumber: 15\n          }\n        }, event.title || 'Event'), numberOfLines > 1 ? React.createElement(Text, {\n          numberOfLines: numberOfLines - 1,\n          style: [styles.eventSummary],\n          __self: _this5,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 150,\n            columnNumber: 17\n          }\n        }, event.summary || ' ') : null, numberOfLines > 2 ? React.createElement(Text, {\n          style: styles.eventTimes,\n          numberOfLines: 1,\n          __self: _this5,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 158,\n            columnNumber: 17\n          }\n        }, moment(event.start).format(formatTime), \" -\", ' ', moment(event.end).format(formatTime)) : null));\n      });\n      return React.createElement(View, {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 170,\n          columnNumber: 7\n        }\n      }, React.createElement(View, {\n        style: {\n          marginLeft: LEFT_MARGIN\n        },\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 171,\n          columnNumber: 9\n        }\n      }, events));\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      var _this6 = this;\n\n      var styles = this.props.styles;\n      return React.createElement(ScrollView, {\n        ref: function ref(_ref) {\n          return _this6._scrollView = _ref;\n        },\n        contentContainerStyle: [styles.contentStyle, {\n          width: this.props.width\n        }],\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 179,\n          columnNumber: 7\n        }\n      }, this._renderLines(), this._renderEvents());\n    }\n  }]);\n\n  return DayView;\n}(React.PureComponent);\n\nexport { DayView as default };","map":{"version":3,"sources":["E:/TotNghiep/TotNghiep/src/screens/home/calendar/timeline_calendar/DayView.js"],"names":["populateEvents","React","moment","_","LEFT_MARGIN","CALENDER_HEIGHT","TEXT_LINE_HEIGHT","range","from","to","Array","i","DayView","props","calendarHeight","end","start","width","packedEvents","events","initPosition","min","map","state","_scrollY","nextProps","setState","scrollToFirst","setTimeout","_scrollView","scrollTo","x","y","animated","format24h","offset","index","timeText","styles","timeLabel","top","line","item","event","eventTapped","style","left","height","eventColor","backgroundColor","color","numberOfLines","Math","floor","formatTime","_onEventTapped","renderEvent","eventTitle","title","eventSummary","summary","eventTimes","format","marginLeft","ref","contentStyle","_renderLines","_renderEvents","PureComponent"],"mappings":"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","sourcesContent":["// @flow\r\nimport { View, Text, ScrollView, TouchableOpacity } from 'react-native';\r\nimport populateEvents from './Packer';\r\nimport React from 'react';\r\nimport moment from 'moment';\r\nimport _ from 'lodash';\r\n\r\nconst LEFT_MARGIN = 60 - 1;\r\n// const RIGHT_MARGIN = 10\r\nconst CALENDER_HEIGHT = 2400;\r\n// const EVENT_TITLE_HEIGHT = 15\r\nconst TEXT_LINE_HEIGHT = 17;\r\n// const MIN_EVENT_TITLE_WIDTH = 20\r\n// const EVENT_PADDING_LEFT = 4\r\n\r\nfunction range(from, to) {\r\n  return Array.from(Array(to), (_, i) => from + i);\r\n}\r\n\r\nexport default class DayView extends React.PureComponent {\r\n  constructor(props) {\r\n    super(props);\r\n    this.calendarHeight = (props.end - props.start) * 100;\r\n    const width = props.width - LEFT_MARGIN;\r\n    const packedEvents = populateEvents(props.events, width, props.start);\r\n    let initPosition =\r\n      _.min(_.map(packedEvents, 'top')) -\r\n      this.calendarHeight / (props.end - props.start);\r\n    initPosition = initPosition < 0 ? 0 : initPosition;\r\n    this.state = {\r\n      _scrollY: initPosition,\r\n      packedEvents,\r\n    };\r\n  }\r\n\r\n  UNSAFE_componentWillReceiveProps(nextProps) {\r\n    const width = nextProps.width - LEFT_MARGIN;\r\n    this.setState({\r\n      packedEvents: populateEvents(nextProps.events, width, nextProps.start),\r\n    });\r\n  }\r\n\r\n  componentDidMount() {\r\n    this.props.scrollToFirst && this.scrollToFirst();\r\n  }\r\n\r\n  scrollToFirst() {\r\n    setTimeout(() => {\r\n      if (this.state && this.state._scrollY && this._scrollView) {\r\n        this._scrollView.scrollTo({\r\n          x: 0,\r\n          y: this.state._scrollY,\r\n          animated: true,\r\n        });\r\n      }\r\n    }, 1);\r\n  }\r\n\r\n  _renderLines() {\r\n    const { format24h, start, end } = this.props;\r\n    const offset = this.calendarHeight / (end - start);\r\n\r\n    return range(start, end + 1).map((i, index) => {\r\n      let timeText;\r\n      if (i === start) {\r\n        timeText = ``;\r\n      } else if (i < 12) {\r\n        timeText = !format24h ? `${i} AM` : `${i}:00`;\r\n      } else if (i === 12) {\r\n        timeText = !format24h ? `${i} PM` : `${i}:00`;\r\n      } else if (i === 24) {\r\n        timeText = !format24h ? `12 AM` : `23:59`;\r\n      } else {\r\n        timeText = !format24h ? `${i - 12} PM` : `${i}:00`;\r\n      }\r\n      const { width, styles } = this.props;\r\n      return [\r\n        <Text\r\n          key={`timeLabel${i}`}\r\n          style={[styles.timeLabel, { top: offset * index - 6 }]}\r\n        >\r\n          {timeText}\r\n        </Text>,\r\n        i === start ? null : (\r\n          <View\r\n            key={`line${i}`}\r\n            style={[styles.line, { top: offset * index, width: width - 20 }]}\r\n          />\r\n        ),\r\n        <View\r\n          key={`lineHalf${i}`}\r\n          style={[\r\n            styles.line,\r\n            { top: offset * (index + 0.5), width: width - 20 },\r\n          ]}\r\n        />,\r\n      ];\r\n    });\r\n  }\r\n\r\n  _renderTimeLabels() {\r\n    const { styles, start, end } = this.props;\r\n    const offset = this.calendarHeight / (end - start);\r\n    return range(start, end).map((item, i) => {\r\n      return (\r\n        <View key={`line${i}`} style={[styles.line, { top: offset * i }]} />\r\n      );\r\n    });\r\n  }\r\n\r\n  _onEventTapped(event) {\r\n    this.props.eventTapped(event);\r\n  }\r\n\r\n  _renderEvents() {\r\n    const { styles } = this.props;\r\n    const { packedEvents } = this.state;\r\n    let events = packedEvents.map((event, i) => {\r\n      const style = {\r\n        left: event.left,\r\n        height: event.height,\r\n        width: event.width,\r\n        top: event.top,\r\n      };\r\n\r\n      const eventColor = {\r\n        backgroundColor: event.color,\r\n      };\r\n\r\n      // Fixing the number of lines for the event title makes this calculation easier.\r\n      // However it would make sense to overflow the title to a new line if needed\r\n      const numberOfLines = Math.floor(event.height / TEXT_LINE_HEIGHT);\r\n      const formatTime = this.props.format24h ? 'HH:mm' : 'hh:mm A';\r\n      return (\r\n        <TouchableOpacity\r\n          activeOpacity={0.5}\r\n          onPress={() =>\r\n            this._onEventTapped(this.props.events[event.index])\r\n          }\r\n          key={i} style={[styles.event, style, event.color && eventColor]}\r\n        >\r\n          {this.props.renderEvent ? (\r\n            this.props.renderEvent(event)\r\n          ) : (\r\n            <View>\r\n              <Text numberOfLines={1} style={styles.eventTitle}>\r\n                {event.title || 'Event'}\r\n              </Text>\r\n              {numberOfLines > 1 ? (\r\n                <Text\r\n                  numberOfLines={numberOfLines - 1}\r\n                  style={[styles.eventSummary]}\r\n                >\r\n                  {event.summary || ' '}\r\n                </Text>\r\n              ) : null}\r\n              {numberOfLines > 2 ? (\r\n                <Text style={styles.eventTimes} numberOfLines={1}>\r\n                  {moment(event.start).format(formatTime)} -{' '}\r\n                  {moment(event.end).format(formatTime)}\r\n                </Text>\r\n              ) : null}\r\n              </View>\r\n          )}\r\n        </TouchableOpacity>\r\n      );\r\n    });\r\n\r\n    return (\r\n      <View>\r\n        <View style={{ marginLeft: LEFT_MARGIN }}>{events}</View>\r\n      </View>\r\n    );\r\n  }\r\n\r\n  render() {\r\n    const { styles } = this.props;\r\n    return (\r\n      <ScrollView\r\n        ref={ref => (this._scrollView = ref)}\r\n        contentContainerStyle={[\r\n          styles.contentStyle,\r\n          { width: this.props.width },\r\n        ]}\r\n      >\r\n        {this._renderLines()}\r\n        {this._renderEvents()}\r\n      </ScrollView>\r\n    );\r\n  }\r\n}"]},"metadata":{},"sourceType":"module"}